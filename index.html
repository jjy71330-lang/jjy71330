<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACDelco 예약대장 (복구)</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; padding: 10px; background: #f0f2f5; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        .header { text-align: center; border-bottom: 2px solid #333; margin-bottom: 20px; }
        
        /* 예약 등록 버튼 - 눈에 확 띄게 */
        .add-btn { width: 100%; padding: 15px; background: #e63946; color: white; border: none; border-radius: 5px; font-size: 20px; font-weight: bold; cursor: pointer; margin-bottom: 20px; }
        
        .time-row { display: grid; grid-template-columns: 80px 1fr 1fr 1fr; gap: 5px; border-bottom: 1px solid #ddd; min-height: 80px; padding: 5px 0; }
        .slot { border: 1px solid #ccc; padding: 5px; cursor: pointer; border-radius: 5px; min-height: 70px; }
        .slot.booked { background: #0052cc; color: white; }
        .car-no { font-weight: bold; font-size: 18px; }

        /* 입력창(모달) - 화면 정중앙에 강제 고정 */
        #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; justify-content: center; align-items: center; }
        .modal-box { background: white; padding: 30px; border-radius: 10px; width: 300px; }
        input { width: 100%; padding: 10px; margin-bottom: 10px; box-sizing: border-box; font-size: 16px; border: 1px solid #ddd; }
        .save-btn { width: 100%; padding: 15px; background: #4f46e5; color: white; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <div class="header"><h1>ACDelco 예약대장</h1></div>
    
    <button class="add-btn" onclick="openModal()">+ 새 예약 등록하기</button>

    <div id="timetable"></div>
</div>

<div id="modal">
    <div class="modal-box">
        <h2 style="margin-top:0; text-align:center;">예약 입력</h2>
        <label style="font-size:12px;">리프트 선택 (1~3)</label>
        <input type="number" id="mLift" min="1" max="3" value="1">
        <label style="font-size:12px;">시간 선택 (예: 09:00)</label>
        <input type="text" id="mTime" placeholder="09:00">
        <label style="font-size:12px;">차량번호</label>
        <input type="text" id="mCarNo" placeholder="차량번호">
        <label style="font-size:12px;">담당자</label>
        <input type="text" id="mWorker" placeholder="담당자">
        
        <button class="save-btn" onclick="doSave()">저장하기</button>
        <button onclick="closeModal()" style="width:100%; margin-top:5px; padding:10px; border:none; background:#eee; cursor:pointer;">닫기</button>
    </div>
</div>

<script>
    const times = ["09:00", "10:00", "11:00", "12:00", "13:00", "14:00", "15:00", "16:00", "17:00"];
    let db = {};
    const SYNC_URL = "https://kvdb.io/A8v8bY6G7z5Lq9x4E3wR1t/jjy_vFinal_0114";

    async function loadData() {
        try {
            const res = await fetch(`${SYNC_URL}?t=${Date.now()}`);
            if (res.ok) { db = await res.json(); render(); }
        } catch (e) { console.log("불러오기 실패"); }
    }

    async function doSave() {
        const time = document.getElementById('mTime').value;
        const lift = document.getElementById('mLift').value;
        const carNo = document.getElementById('mCarNo').value;
        if(!time || !carNo) return alert("시간과 차량번호를 써주세요!");

        db[time + '-' + lift] = { carNo: carNo, worker: document.getElementById('mWorker').value };
        render(); // 화면 먼저 그리고
        closeModal(); // 창 닫고
        
        try { // 서버 전송
            await fetch(`${SYNC_URL}`, { method: 'POST', body: JSON.stringify(db) });
        } catch (e) { alert("서버 전송 실패(임시저장됨)"); }
    }

    function render() {
        const target = document.getElementById('timetable');
        target.innerHTML = '';
        times.forEach(t => {
            let row = `<div class="time-row"><div style="display:flex; align-items:center; font-weight:bold;">${t}</div>`;
            for(let i=1; i<=3; i++) {
                const id = t + '-' + i;
                const item = db[id];
                row += `<div class="slot ${item?'booked':''}" onclick="openEdit('${t}', '${i}')">
                            ${item ? '<div class="car-no">'+item.carNo+'</div>' : ''}
                        </div>`;
            }
            row += `</div>`;
            target.innerHTML += row;
        });
    }

    function openModal() { document.getElementById('modal').style.display = 'flex'; }
    function closeModal() { document.getElementById('modal').style.display = 'none'; }
    function openEdit(t, l) {
        document.getElementById('mTime').value = t;
        document.getElementById('mLift').value = l;
        openModal();
    }

    loadData();
    setInterval(loadData, 10000); // 10초마다 자동 연동
</script>
</body>
</html>
