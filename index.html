<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACDelco ì˜ˆì•½ëŒ€ì¥ (ë³µêµ¬ ì™„ë£Œ)</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; background-color: #f0f2f5; margin: 0; padding: 10px; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 15px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .header { text-align: center; border-bottom: 3px solid #000; padding-bottom: 10px; margin-bottom: 15px; }
        
        /* ìƒë‹¨ ë°” ë° ë²„íŠ¼ */
        .top-bar { display: flex; justify-content: space-between; align-items: center; background: #1e293b; color: white; padding: 10px 15px; border-radius: 8px; margin-bottom: 10px; }
        .write-btn { background: #e63946; color: white; border: none; padding: 12px 20px; border-radius: 6px; font-weight: bold; font-size: 18px; cursor: pointer; box-shadow: 0 4px 0 #b91c1c; }
        .write-btn:active { transform: translateY(2px); box-shadow: 0 2px 0 #b91c1c; }

        .date-bar { display: flex; justify-content: center; align-items: center; gap: 8px; margin-bottom: 15px; padding: 10px; background: #eef2ff; border-radius: 8px; }
        .btn-date { background: #4f46e5; color: white; border: none; padding: 10px 15px; border-radius: 6px; cursor: pointer; font-weight: bold; }
        #target-date { font-size: 20px; font-weight: bold; border: 2px solid #ddd; padding: 5px; }

        /* ì‹œê°„í‘œ ë””ìì¸ */
        .grid-head { display: grid; grid-template-columns: 80px 1fr 1fr 1fr; gap: 5px; background: #eee; text-align: center; font-weight: bold; padding: 10px 0; border-bottom: 2px solid #333; font-size: 16px; }
        .row { display: grid; grid-template-columns: 80px 1fr 1fr 1fr; gap: 5px; border-bottom: 1px solid #ddd; height: 110px; padding: 5px 0; }
        .time-cell { display: flex; align-items: center; justify-content: center; font-weight: bold; background: #f8f9fa; font-size: 18px; border-radius: 4px; }
        
        .slot { background: #fff; border: 1px solid #ccc; border-radius: 6px; padding: 8px; cursor: pointer; display: flex; flex-direction: column; justify-content: center; position: relative; }
        .slot.booked { background-color: #0052cc !important; color: white !important; }
        .slot.done { background-color: #7f8c8d !important; color: #ccc !important; }
        .car-no { font-weight: 900; font-size: 20px; margin-bottom: 3px; }
        .worker { font-size: 14px; color: #ffeb3b; font-weight: bold; }

        /* ì…ë ¥ ëª¨ë‹¬ì°½ (ê°•ë ¥í•˜ê²Œ ê³ ì •) */
        #modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); justify-content:center; align-items:center; z-index:9999; }
        .modal-box { background:white; padding:25px; border-radius:15px; width:340px; box-shadow: 0 10px 25px rgba(0,0,0,0.5); }
        .modal-box h3 { margin: 0 0 15px 0; text-align: center; color: #333; }
        .modal-box label { font-size: 12px; font-weight: bold; color: #666; display: block; margin-top: 10px; }
        input, select { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        .modal-btns { display: flex; gap: 8px; margin-top: 20px; }
        .modal-btns button { flex: 1; padding: 15px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 16px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header"><h1>ACDelco ì˜ˆì•½ëŒ€ì¥</h1></div>
    
    <div class="top-bar">
        <div id="status-text">ğŸ“¡ ì‹œìŠ¤í…œ ì¤€ë¹„ì™„ë£Œ</div>
        <button class="write-btn" onclick="openWriteModal()">+ ìƒˆ ì˜ˆì•½ ë“±ë¡</button>
    </div>

    <div class="date-bar">
        <button class="btn-date" onclick="moveDate(-1)">â—€ ì–´ì œ</button>
        <input type="date" id="target-date" onchange="loadData()">
        <button class="btn-date" onclick="moveDate(1)">ë‚´ì¼ â–¶</button>
        <button onclick="loadData()" style="padding: 10px; cursor: pointer; border-radius: 6px; border: 1px solid #ccc;">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
    </div>

    <div class="grid-head">
        <div>ì‹œê°„</div><div>ë¦¬í”„íŠ¸ 1</div><div>ë¦¬í”„íŠ¸ 2</div><div>ë¦¬í”„íŠ¸ 3</div>
    </div>
    <div id="timetable"></div>
</div>

<div id="modal">
    <div class="modal-box">
        <h3>ğŸ”§ ì˜ˆì•½ ì •ë³´ ì…ë ¥</h3>
        <label>ë¦¬í”„íŠ¸ ë° ì‹œê°„ ì„ íƒ</label>
        <div style="display:flex; gap:5px;">
            <select id="selTime"></select>
            <select id="selLift">
                <option value="1">ë¦¬í”„íŠ¸ 1</option>
                <option value="2">ë¦¬í”„íŠ¸ 2</option>
                <option value="3">ë¦¬í”„íŠ¸ 3</option>
            </select>
        </div>
        <label>ì°¨ëŸ‰ë²ˆí˜¸</label><input type="text" id="inCarNo" placeholder="ì˜ˆ: 12ê°€ 3456">
        <label>ì°¨ì¢…</label><input type="text" id="inModel" placeholder="ì˜ˆ: ì•Œí˜ì˜¨">
        <label>ğŸ› ï¸ ë‹´ë‹¹ ì‘ì—…ì</label><input type="text" id="inWorker" placeholder="ë‹´ë‹¹ì ì„±í•¨">
        <div style="margin-top: 15px;"><label style="cursor:pointer; display:flex; align-items:center; gap:10px;"><input type="checkbox" id="inDone" style="width:20px; height:20px;"> <b>ì •ë¹„ ì™„ë£Œ</b></label></div>
        
        <div class="modal-btns">
            <button style="background:#4f46e5; color:white;" onclick="doSave()">ì €ì¥í•˜ê¸°</button>
            <button style="background:#dc3545; color:white;" onclick="doDelete()">ì‚­ì œ</button>
            <button style="background:#666; color:white;" onclick="closeModal()">ë‹«ê¸°</button>
        </div>
    </div>
</div>

<script>
    const timeList = ["09:00", "10:00", "11:00", "12:00", "13:00", "14:00", "15:00", "16:00", "17:00"];
    let db = {};
    let isSaving = false;
    const KEY_URL = "https://kvdb.io/A8v8bY6G7z5Lq9x4E3wR1t/acdelco_final_fix_2026";

    function init() {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('target-date').value = today;
        
        // ì‹œê°„ ì„ íƒ ì˜µì…˜ ë§Œë“¤ê¸°
        const selTime = document.getElementById('selTime');
        timeList.forEach(t => { if(t !== "12:00") selTime.innerHTML += `<option value="${t}">${t}</option>`; });

        loadData();
        setInterval(() => { if(!isSaving) loadData(); }, 10000);
    }

    async function loadData() {
        if(isSaving) return;
        const date = document.getElementById('target-date').value;
        const status = document.getElementById('status-text');
        try {
            const res = await fetch(`${KEY_URL}_${date}?t=${Date.now()}`);
            if (res.ok) {
                const data = await res.json();
                if(Object.keys(data).length > 0) { db = data; }
                status.innerText = "ğŸŸ¢ ì‹¤ì‹œê°„ ì—°ê²° ì„±ê³µ";
            } else { status.innerText = "âšª ìƒˆ ë¬¸ì„œ (ì…ë ¥ ëŒ€ê¸°)"; }
        } catch (e) { status.innerText = "ğŸ”´ í†µì‹  í™•ì¸ ì¤‘"; }
        render();
    }

    async function saveData() {
        isSaving = true;
        const date = document.getElementById('target-date').value;
        document.getElementById('status-text').innerText = "ğŸŸ¡ ì„œë²„ ì €ì¥ ì¤‘...";
        try {
            await fetch(`${KEY_URL}_${date}`, { method: 'POST', body: JSON.stringify(db) });
            document.getElementById('status-text').innerText = "âœ… ì €ì¥ ì™„ë£Œ";
        } catch (e) { document.getElementById('status-text').innerText = "âš ï¸ ì„ì‹œ ì €ì¥"; }
        setTimeout(() => { isSaving = false; }, 5000);
    }

    function render() {
        const target = document.getElementById('timetable');
        target.innerHTML = '';
        timeList.forEach(t => {
            const row = document.createElement('div');
            row.className = 'row';
            row.innerHTML = `<div class="time-cell">${t}</div>`;
            if (t === "12:00") {
                row.innerHTML += `<div style="grid-column: span 3; background:#ffe3e3; color:#e03131; display:flex; align-items:center; justify-content:center; font-weight:bold; border-radius:6px;">ğŸ´ ì  ì‹¬ ì‹œ ê°„</div>`;
            } else {
                for (let i = 1; i <= 3; i++) {
                    const id = t + '-' + i;
                    const item = db[id];
                    let cls = 'slot', content = '';
                    if (item) {
                        cls += ' booked'; if (item.isDone) cls += ' done';
                        content = `<div class="car-no">${item.isDone ? 'âœ…' : ''}${item.carNo}</div><div class="worker">${item.worker}</div>`;
                    }
                    row.innerHTML += `<div class="${cls}" onclick="openEditModal('${id}')">${content}</div>`;
                }
            }
            target.appendChild(row);
        });
    }

    // ìƒˆ ì˜ˆì•½ ë²„íŠ¼ ëˆŒë €ì„ ë•Œ
    function openWriteModal() {
        document.getElementById('inCarNo').value = '';
        document.getElementById('inModel').value = '';
        document.getElementById('inWorker').value = '';
        document.getElementById('inDone').checked = false;
        document.getElementById('modal').style.display = 'flex';
    }

    // ì¹¸ì„ í´ë¦­í•´ì„œ ìˆ˜ì •í•  ë•Œ
    function openEditModal(id) {
        const [t, l] = id.split('-');
        document.getElementById('selTime').value = t;
        document.getElementById('selLift').value = l;
        const item = db[id] || { carNo: '', model: '', worker: '', isDone: false };
        document.getElementById('inCarNo').value = item.carNo;
        document.getElementById('inModel').value = item.model;
        document.getElementById('inWorker').value = item.worker;
        document.getElementById('inDone').checked = item.isDone;
        document.getElementById('modal').style.display = 'flex';
    }

    function closeModal() { document.getElementById('modal').style.display = 'none'; }

    function doSave() {
        const time = document.getElementById('selTime').value;
        const lift = document.getElementById('selLift').value;
        const carNo = document.getElementById('inCarNo').value;
        if (!carNo) return alert("ì°¨ëŸ‰ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!");
        
        db[time + '-' + lift] = {
            carNo: carNo,
            model: document.getElementById('inModel').value,
            worker: document.getElementById('inWorker').value,
            isDone: document.getElementById('inDone').checked
        };
        render();
        closeModal();
        saveData();
    }

    function doDelete() {
        if (!confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
        const time = document.getElementById('selTime').value;
        const lift = document.getElementById('selLift').value;
        delete db[time + '-' + lift];
        render();
        closeModal();
        saveData();
    }

    function moveDate(days) {
        const dt = new Date(document.getElementById('target-date').value);
        dt.setDate(dt.getDate() + days);
        document.getElementById('target-date').value = dt.toISOString().split('T')[0];
        loadData();
    }

    init();
</script>
</body>
</html>
